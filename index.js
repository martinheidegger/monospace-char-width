function isSurrogate (c) {
  return c >= 0xd800 && c <= 0xD8FF
}

function surrogatePair (c, c1) {
  return 0x10000 + ((c & 0x3FF) << 10) | (c1 & 0x3FF)
}

function isSurrogateDouble (c, c1) {
  // only [\u20000-\u2A6D6\u2A6D7-\u2F7FF\u2F800-\u2FA1D\u2FA1E-\u2FFFD\u30000-\u3FFFD] is full width.
  c = surrogatePair(c, c1)
  return (c >= 0x20000 && c <= 0x2A6D6) ||
  (c >= 0x2A6D7 && c <= 0x2F7FF) ||
  (c >= 0x2F800 && c <= 0x2FA1D) ||
  (c >= 0x2FA1E && c <= 0x2FFFD) ||
  (c >= 0x30000 && c <= 0x3FFFD) ||
  (c >= 0xE0100 && c <= 0xE01EF) ||
  (c >= 0xF0000 && c <= 0xFFFFD) ||
  (c >= 0x100000 && c <= 0x10FFFD)
}

function isDouble (c) {
  return (c === 0x3000) ||
  (c >= 0xFF01 && c <= 0xFF60) ||
  (c >= 0xFFE0 && c <= 0xFFE6) ||
  (c >= 0x1100 && c <= 0x115F) ||
  (c >= 0x2329 && c <= 0x232A) ||
  (c >= 0x2E80 && c <= 0x2FFB) ||
  (c >= 0x3001 && c <= 0x303E) ||
  (c >= 0x3041 && c <= 0x33FF) ||
  (c >= 0x3400 && c <= 0x4DB5) ||
  (c >= 0x4E00 && c <= 0x9FBB) ||
  (c >= 0xA000 && c <= 0xA4C6) ||
  (c >= 0xAC00 && c <= 0xD7A3) ||
  (c >= 0xF900 && c <= 0xFAD9) ||
  (c >= 0xFE10 && c <= 0xFE19) ||
  (c >= 0xFE30 && c <= 0xFE6B) ||
  (c === 0x00A1) ||
  (c === 0x00A4) ||
  (c >= 0x00A7 && c <= 0x00A8) ||
  (c === 0x00AA) ||
  (c >= 0x00AD && c <= 0x00AE) ||
  (c >= 0x00B0 && c <= 0x00B4) ||
  (c >= 0x00B6 && c <= 0x00BA) ||
  (c >= 0x00BC && c <= 0x00BF) ||
  (c === 0x00C6) ||
  (c === 0x00D0) ||
  (c >= 0x00D7 && c <= 0x00D8) ||
  (c >= 0x00DE && c <= 0x00E1) ||
  (c === 0x00E6) ||
  (c === 0x00F0) ||
  (c >= 0x00F7 && c <= 0x00F8) ||
  (c === 0x00FC) ||
  (c === 0x00FE) ||
  (c === 0x0101) ||
  (c === 0x0113) ||
  (c === 0x011B) ||
  (c >= 0x0126 && c <= 0x0127) ||
  (c === 0x012B) ||
  (c >= 0x0131 && c <= 0x0133) ||
  (c === 0x0138) ||
  (c >= 0x013F && c <= 0x0142) ||
  (c === 0x0144) ||
  (c >= 0x0148 && c <= 0x014B) ||
  (c === 0x014D) ||
  (c >= 0x0152 && c <= 0x0153) ||
  (c >= 0x0166 && c <= 0x0167) ||
  (c === 0x016B) ||
  (c === 0x01CE) ||
  (c === 0x01D0) ||
  (c === 0x01D2) ||
  (c === 0x01D4) ||
  (c === 0x01D6) ||
  (c === 0x01D8) ||
  (c === 0x01DA) ||
  (c === 0x01DC) ||
  (c === 0x0251) ||
  (c === 0x0261) ||
  (c === 0x02C4) ||
  (c === 0x02C7) ||
  (c >= 0x02C9 && c <= 0x02CB) ||
  (c === 0x02CD) ||
  (c === 0x02D0) ||
  (c >= 0x02D8 && c <= 0x02DB) ||
  (c === 0x02DD) ||
  (c === 0x02DF) ||
  (c >= 0x0300 && c <= 0x036F) ||
  (c >= 0x0391 && c <= 0x03A9) ||
  (c >= 0x03B1 && c <= 0x03C1) ||
  (c >= 0x03C3 && c <= 0x03C9) ||
  (c === 0x0401) ||
  (c >= 0x0410 && c <= 0x044F) ||
  (c === 0x0451) ||
  (c === 0x2010) ||
  (c >= 0x2013 && c <= 0x2016) ||
  (c >= 0x2018 && c <= 0x2019) ||
  (c >= 0x201C && c <= 0x201D) ||
  (c >= 0x2020 && c <= 0x2022) ||
  (c >= 0x2024 && c <= 0x2027) ||
  (c === 0x2030) ||
  (c >= 0x2032 && c <= 0x2033) ||
  (c === 0x2035) ||
  (c === 0x203B) ||
  (c === 0x203E) ||
  (c === 0x2074) ||
  (c === 0x207F) ||
  (c >= 0x2081 && c <= 0x2084) ||
  (c === 0x20AC) ||
  (c === 0x2103) ||
  (c === 0x2105) ||
  (c === 0x2109) ||
  (c === 0x2113) ||
  (c === 0x2116) ||
  (c >= 0x2121 && c <= 0x2122) ||
  (c === 0x2126) ||
  (c === 0x212B) ||
  (c >= 0x2153 && c <= 0x2154) ||
  (c >= 0x215B && c <= 0x215E) ||
  (c >= 0x2160 && c <= 0x216B) ||
  (c >= 0x2170 && c <= 0x2179) ||
  (c >= 0x2190 && c <= 0x2199) ||
  (c >= 0x21B8 && c <= 0x21B9) ||
  (c === 0x21D2) ||
  (c === 0x21D4) ||
  (c === 0x21E7) ||
  (c === 0x2200) ||
  (c >= 0x2202 && c <= 0x2203) ||
  (c >= 0x2207 && c <= 0x2208) ||
  (c === 0x220B) ||
  (c === 0x220F) ||
  (c === 0x2211) ||
  (c === 0x2215) ||
  (c === 0x221A) ||
  (c >= 0x221D && c <= 0x2220) ||
  (c === 0x2223) ||
  (c === 0x2225) ||
  (c >= 0x2227 && c <= 0x222C) ||
  (c === 0x222E) ||
  (c >= 0x2234 && c <= 0x2237) ||
  (c >= 0x223C && c <= 0x223D) ||
  (c === 0x2248) ||
  (c === 0x224C) ||
  (c === 0x2252) ||
  (c >= 0x2260 && c <= 0x2261) ||
  (c >= 0x2264 && c <= 0x2267) ||
  (c >= 0x226A && c <= 0x226B) ||
  (c >= 0x226E && c <= 0x226F) ||
  (c >= 0x2282 && c <= 0x2283) ||
  (c >= 0x2286 && c <= 0x2287) ||
  (c === 0x2295) ||
  (c === 0x2299) ||
  (c === 0x22A5) ||
  (c === 0x22BF) ||
  (c === 0x2312) ||
  (c >= 0x2460 && c <= 0x24E9) ||
  (c >= 0x24EB && c <= 0x254B) ||
  (c >= 0x2550 && c <= 0x2573) ||
  (c >= 0x2580 && c <= 0x258F) ||
  (c >= 0x2592 && c <= 0x2595) ||
  (c >= 0x25A0 && c <= 0x25A1) ||
  (c >= 0x25A3 && c <= 0x25A9) ||
  (c >= 0x25B2 && c <= 0x25B3) ||
  (c >= 0x25B6 && c <= 0x25B7) ||
  (c >= 0x25BC && c <= 0x25BD) ||
  (c >= 0x25C0 && c <= 0x25C1) ||
  (c >= 0x25C6 && c <= 0x25C8) ||
  (c === 0x25CB) ||
  (c >= 0x25CE && c <= 0x25D1) ||
  (c >= 0x25E2 && c <= 0x25E5) ||
  (c === 0x25EF) ||
  (c >= 0x2605 && c <= 0x2606) ||
  (c === 0x2609) ||
  (c >= 0x260E && c <= 0x260F) ||
  (c >= 0x2614 && c <= 0x2615) ||
  (c === 0x261C) ||
  (c === 0x261E) ||
  (c === 0x2640) ||
  (c === 0x2642) ||
  (c >= 0x2660 && c <= 0x2661) ||
  (c >= 0x2663 && c <= 0x2665) ||
  (c >= 0x2667 && c <= 0x266A) ||
  (c >= 0x266C && c <= 0x266D) ||
  (c === 0x266F) ||
  (c === 0x273D) ||
  (c >= 0x2776 && c <= 0x277F) ||
  (c >= 0xE000 && c <= 0xF8FF) ||
  (c >= 0xFE00 && c <= 0xFE0F) ||
  (c === 0xFFFD)
}

// https://en.wikipedia.org/wiki/Control_character
function isZero (c) {
  return isSurrogate(c) ||
  c === 0 ||
  c === 7 ||
  c === 127
}

module.exports = function terminalStringWidth (c, cBefore) {
  if (isSurrogate(cBefore)) {
    return isSurrogateDouble(cBefore, c) ? 2 : 1
  }

  if (isZero(c)) {
    return 0
  }

  if (isDouble(c)) {
    return 2
  }

  if (c === 8) { // backwards delete
    return -1
  }

  return 1
}
